<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Tank Arcade Pixel Art</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
body {margin:0; background:#111; display:flex; flex-direction:column; align-items:center; color:white; font-family:monospace; user-select:none; touch-action:none;}
canvas {background:#000; image-rendering:pixelated;}
.controls {display:flex; justify-content:space-between; margin-top:8px;}
.dpad {display:grid; grid-template-columns:48px 48px 48px; grid-template-rows:48px 48px 48px; gap:4px;}
.btn {background:#222; border:2px solid #555; color:white; font-size:18px; text-align:center; line-height:48px; border-radius:8px;}
.fire {width:70px; height:70px; line-height:70px; font-size:22px; background:#400; border-color:#f00;}
.hidden {display:none;}
</style>
</head>
<body>

<canvas id="game" width="416" height="416"></canvas>

<div class="controls hidden" id="controls">
  <div class="dpad">
    <div></div><div class="btn" data-key="ArrowUp">‚¨Ü</div><div></div>
    <div class="btn" data-key="ArrowLeft">‚¨Ö</div><div></div><div class="btn" data-key="ArrowRight">‚û°</div>
    <div></div><div class="btn" data-key="ArrowDown">‚¨á</div><div></div>
  </div>
  <div class="btn fire" data-key="fire">üî•</div>
</div>

<script>
const TILE=32,SIZE=13,BASE_SIZE=416;
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
function resize(){
  const scale=Math.min(window.innerWidth/BASE_SIZE,window.innerHeight/(BASE_SIZE+120));
  canvas.style.width=BASE_SIZE*scale+'px';
  canvas.style.height=BASE_SIZE*scale+'px';
}
window.addEventListener('resize',resize); resize();

const keys={};
addEventListener('keydown',e=>{if(e.key===' ')keys['fire']=true;else keys[e.key]=true;});
addEventListener('keyup',e=>{if(e.key===' ')keys['fire']=false;else keys[e.key]=false;});

const isTouch='ontouchstart' in window||navigator.maxTouchPoints>0;
const controls=document.getElementById('controls');
if(isTouch){controls.classList.remove('hidden');document.querySelectorAll('.btn').forEach(btn=>{const key=btn.dataset.key;btn.addEventListener('touchstart',e=>{e.preventDefault();keys[key]=true;});btn.addEventListener('touchend',e=>{e.preventDefault();keys[key]=false;});});}

function vibrate(ms){if(navigator.vibrate)navigator.vibrate(ms);}

let state='playing';
let map=[
[0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,1,1,0,0,0,0,0,0,1,1,0,0],
[0,1,1,0,0,0,0,0,0,1,1,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,1,1,1,1,1,0,0,0,0],
[0,0,0,0,1,0,0,0,1,0,0,0,0],
[0,0,0,0,1,0,5,0,1,0,0,0,0],
[0,0,0,0,1,0,0,0,1,0,0,0,0],
[0,0,0,0,1,1,1,1,1,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,1,1,0,0,0,0,0,0,1,1,0,0],
[0,1,1,0,0,0,0,0,0,1,1,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0]
];

const player={x:6*TILE,y:11*TILE,dir:'up',speed:2};
const enemy={x:6*TILE,y:0,dir:'down',speed:1,alive:true,timer:0};
let bullets=[];

function canMove(x,y){const tx=Math.floor(x/TILE),ty=Math.floor(y/TILE);return tx>=0&&ty>=0&&tx<SIZE&&ty<SIZE&&map[ty][tx]===0;}
function shoot(owner){bullets.push({x:owner.x+TILE/2,y:owner.y+TILE/2,dir:owner.dir,owner});vibrate(20);}
function hit(b,t){return b.x>t.x&&b.x<t.x+TILE&&b.y>t.y&&b.y<t.y+TILE;}

function update(){
  if(state!=='playing')return;
  let nx=player.x,ny=player.y;
  if(keys['ArrowUp']){ny-=player.speed;player.dir='up';}
  if(keys['ArrowDown']){ny+=player.speed;player.dir='down';}
  if(keys['ArrowLeft']){nx-=player.speed;player.dir='left';}
  if(keys['ArrowRight']){nx+=player.speed;player.dir='right';}
  if(canMove(nx,ny))player.x=nx,player.y=ny;
  if(keys['fire']&&!bullets.find(b=>b.owner===player))shoot(player);

  if(enemy.alive){enemy.timer++;let ex=enemy.x,ey=enemy.y;
    if(enemy.dir==='up')ey-=enemy.speed;
    if(enemy.dir==='down')ey+=enemy.speed;
    if(enemy.dir==='left')ex-=enemy.speed;
    if(enemy.dir==='right')ex+=enemy.speed;
    if(canMove(ex,ey))enemy.x=ex,enemy.y=ey; else enemy.dir=['up','down','left','right'][Math.random()*4|0];
    if(enemy.timer%120===0)shoot(enemy);
  }

  bullets.forEach((b,i)=>{
    if(b.dir==='up')b.y-=4;
    if(b.dir==='down')b.y+=4;
    if(b.dir==='left')b.x-=4;
    if(b.dir==='right')b.x+=4;
    const tx=Math.floor(b.x/TILE),ty=Math.floor(b.y/TILE);
    if(map[ty]?.[tx]===1){map[ty][tx]=0;vibrate(30);bullets.splice(i,1);return;}
    if(map[ty]?.[tx]===5){vibrate([100,50,100]);state='gameover';}
    if(b.owner!==player&&hit(b,player)){vibrate([200,100,200]);state='gameover';}
    if(b.owner===player&&enemy.alive&&hit(b,enemy)){enemy.alive=false;vibrate(60);bullets.splice(i,1);}
  });
}

function drawTank(tank,color){
  // –∫–æ—Ä–ø—É—Å
  ctx.fillStyle=color; ctx.fillRect(tank.x+4,tank.y+4,TILE-8,TILE-8);
  // –∫–æ–ª—ë—Å–∞
  ctx.fillStyle=shadeColor(color,-40);
  ctx.fillRect(tank.x+2,tank.y+2,4,TILE-4);
  ctx.fillRect(tank.x+TILE-6,tank.y+2,4,TILE-4);
  // –±–∞—à–Ω—è
  ctx.fillStyle=shadeColor(color,-20);
  if(tank.dir==='up'||tank.dir==='down') ctx.fillRect(tank.x+TILE/2-4,tank.y,8,TILE/2);
  else ctx.fillRect(tank.x,tank.y+TILE/2-4,TILE/2,8);
}

function shadeColor(color, percent){
  let f=parseInt(color.slice(1),16),t=percent<0?0:255,p=percent<0?percent*-1:percent;
  let R=f>>16,G=f>>8&0x00FF,B=f&0x0000FF;
  return "#"+(0x1000000+(Math.round((t-R)*p/100)+R)*0x10000+(Math.round((t-G)*p/100)+G)*0x100+(Math.round((t-B)*p/100)+B)).toString(16).slice(1);
}

function render(){
  ctx.clearRect(0,0,BASE_SIZE,BASE_SIZE);
  for(let y=0;y<SIZE;y++)for(let x=0;x<SIZE;x++){
    if(map[y][x]===1){ctx.fillStyle='#b55239';ctx.fillRect(x*TILE,y*TILE,TILE,TILE);}
    if(map[y][x]===5){ctx.fillStyle='gold';ctx.fillRect(x*TILE,y*TILE,TILE,TILE);}
  }
  drawTank(player,'#0f0');
  if(enemy.alive)drawTank(enemy,'#f00');
  bullets.forEach(b=>{
    ctx.fillStyle=b.owner===player?'#0ff':'#f0f';
    ctx.fillRect(b.x-2,b.y-2,4,4);
  });
  if(state==='gameover'){
    ctx.fillStyle='rgba(0,0,0,0.7)'; ctx.fillRect(0,0,BASE_SIZE,BASE_SIZE);
    ctx.fillStyle='#fff'; ctx.fillText('GAME OVER',160,200);
  }
}

function loop(){update();render();requestAnimationFrame(loop);}
loop();
</script>

</body>
</html>
